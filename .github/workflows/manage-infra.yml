name: Create or Delete Azure Infrastructure
 
on:
  workflow_dispatch:
    inputs:
      action:
        description: "Action to perform"
        required: true
        type: choice
        options:
          - create
          - delete
 
jobs:
  infra:
    runs-on: ubuntu-22.04
 
    steps:
      # Step 1: Checkout code
      - name: Checkout repository
        uses: actions/checkout@v4
 
      # Step 2: Login to Azure
      - name: Login to Azure
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}
 
      # Step 3: Install Container Apps extension
      - name: Install containerapp extension
        run: |
          az extension add --name containerapp --yes || az extension update --name containerapp
 
      # Step 4: Run script with action input (CREATE or DELETE)
      - name: Run infra script
        run: |
          chmod +x scripts/manage-infra.sh
          ./scripts/manage-infra.sh "${{ github.event.inputs.action }}"