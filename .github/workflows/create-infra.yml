# Name of the workflow
name: Manage Azure Infrastructure

# This workflow will be triggered MANUALLY from the GitHub Actions tab.
on:
  workflow_dispatch:
    # Add inputs to be provided in the GitHub UI
    inputs:
      action:
        description: 'Action to perform'
        required: true
        type: choice
        options:
        - create
        - destroy
        default: 'create'
      resource_group:
        description: 'Name of the Resource Group'
        required: true
        default: 'exr-dvo-intern-inc'

jobs:
  manage-infrastructure:
    runs-on: ubuntu-latest

    steps:
      # Step 1: Check out the repository so we can access our script.
      - name: Checkout repository
        uses: actions/checkout@v4

      # Step 2: Log in to Azure using the Service Principal.
      - name: Azure Login
        uses: azure/login@v1
        with:
          creds: ${{ secrets.AZURE_CREDENTIALS }}

      # Step 3: Run the Infrastructure Management Script
      # This single step calls our script and passes the selected action ('create' or 'destroy')
      # as a command-line argument.
      - name: Run Infrastructure Script (${{ github.event.inputs.action }})
        run: ./scripts/manage-infra.sh ${{ github.event.inputs.action }}
        env:
          # Pass the workflow inputs and other variables as environment variables
          SUBSCRIPTION_NAME: "Founder-HUB-Microsoft Azure Sponsorship"
          RESOURCE_GROUP: ${{ github.event.inputs.resource_group }}
          LOCATION: "centralindia"
          ACR_NAME: "messageappacr"